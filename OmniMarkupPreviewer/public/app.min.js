window.App={};window.App.Context={};window.App.Options={};
$(function(){function d(a,c,e){a=a?a:0;if(c&&(!a||a>c))a=c;return e&&(!a||a>e)?e:a}function g(){return{height:$("html, body").height(),sliderHeight:d(window.innerHeight?window.innerHeight:0,document.documentElement?document.documentElement.clientHeight:0,document.body?document.body.clientHeight:0),sliderPos:d(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}}function h(a){var c=g().height-a.height;$("html, body").animate({scrollTop:a.sliderPos+
c},"fast")}function k(){$.ajax({type:"POST",url:"/api/revive",data:JSON.stringify({revivable_key:window.App.Context.revivable_key}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(a){a&&"OK"===a.status&&(f=!1,window.location.replace("/view/"+a.buffer_id.toString()))}).always(function(){f&&setTimeout(k,Math.max(l,600))})}(function(){$("script").each(function(){var a=String(this.type).replace(/ /g,"");a.match(/^text\/x-omnimarkup-config(;.*)?$/)&&!a.match(/;executed=true/)&&
(this.type+=";executed=true",eval(this.innerHTML))})})();var l=window.App.Options.ajax_polling_interval,m=window.App.Options.mathjax_enabled,f=!1;(function c(){var e=$("#content"),d={buffer_id:window.App.Context.buffer_id,timestamp:window.App.Context.timestamp};setTimeout(function(){$.ajax({type:"POST",url:"/api/query",data:JSON.stringify(d),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(b){if(b)switch(b.status){case "DISCONNECTED":f=!0;break;case "OK":var c=g();document.title=
b.filename+"\u2014"+b.dirname;$("#filename").text(b.filename);e.empty().html(b.html_part);window.App.Context.timestamp=b.timestamp;window.App.Context.revivable_key=b.revivable_key;var d=$("img");b=0<d.length?function(){d.imagesLoaded(function(){h(c)})}:function(){h(c)};m?MathJax.Hub.Queue(["resetEquationNumbers",MathJax.InputJax.TeX],["Typeset",MathJax.Hub,e[0]],b):b()}}).fail(function(){}).always(function(){f?k():c()})},l)})()});
